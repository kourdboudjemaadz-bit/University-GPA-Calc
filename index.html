<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMAIC - GPA Calculator | Royal Edition</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Poppins:wght@400;600;700;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary: #4f46e5; --primary-dark: #4338ca; --accent: #fbbf24;
            --bg-body: #f0f4ff; --bg-gradient: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            --card-bg: rgba(255, 255, 255, 0.98); --text-main: #1e293b;
            --input-bg: #f8fafc; --mention-bg: #f1f5f9;
            --danger: #ef4444; --success: #10b981;
            --font-ar: 'Cairo', sans-serif; --font-en: 'Poppins', sans-serif;
        }

        [data-theme="dark"] {
            --primary: #6366f1; --bg-body: #0f172a;
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --card-bg: rgba(30, 41, 59, 0.98); --text-main: #f1f5f9;
            --input-bg: #334155; --mention-bg: #1e293b;
        }

        body { font-family: var(--font-ar); background: var(--bg-gradient); margin: 0; padding: 20px; color: var(--text-main); min-height: 100vh; transition: 0.3s; }
        html[lang="en"] body { font-family: var(--font-en); }

        .container {
            width: 100%; max-width: 900px; background: var(--card-bg);
            border-radius: 24px; margin: 0 auto; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            overflow: hidden; position: relative; border: 1px solid rgba(255,255,255,0.1);
        }

        /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ (Gauge) Ø§Ù„Ù…Ø³ØªÙˆØ­Ù‰ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø© --- */
        .dashboard { padding: 40px 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        
        .gauge-container {
            position: relative;
            width: 300px;
            height: 150px; /* Ù†ØµÙ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù„Ø®Ù„Ù‚ Ù†ØµÙ Ø¯Ø§Ø¦Ø±Ø© */
            margin: 0 auto 20px;
        }

        .gauge-outline {
            position: absolute;
            top: 0; left: 0;
            width: 300px; height: 300px;
            border-radius: 50%;
            border: 12px solid var(--accent); /* Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ø§Ù„Ø£ØµÙØ± */
            clip-path: inset(0 0 50% 0); /* Ù‚Øµ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³ÙÙ„ÙŠ */
            opacity: 0.3;
        }

        .gauge-body {
            position: absolute;
            top: 25px; left: 25px; /* Ù…ÙˆØ§Ø²Ù†ØªÙ‡ Ù„ÙŠÙƒÙˆÙ† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø·Ø§Ø± */
            width: 250px; height: 250px;
            border-radius: 50%;
            background: #e2e8f0; /* Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„ÙØ§Ø±ØºØ© */
            clip-path: inset(0 0 50% 0);
        }

        [data-theme="dark"] .gauge-body { background: #334155; }

        .gauge-fill {
            position: absolute;
            top: 25px; left: 25px;
            width: 250px; height: 250px;
            border-radius: 50%;
            background: var(--primary);
            clip-path: inset(0 0 50% 0);
            transform-origin: center center;
            transform: rotate(-180deg);
            transition: transform 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), background 0.5s;
        }

        /* Ø§Ù„ÙØ±Ø§Øº Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ Ù„ÙŠØ¸Ù‡Ø± ÙƒÙ‚ÙˆØ³ ÙˆÙ„ÙŠØ³ Ù†ØµÙ Ù‚Ø±Øµ */
        .gauge-cover {
            position: absolute;
            top: 60px; left: 60px;
            width: 180px; height: 180px;
            background: var(--card-bg);
            border-radius: 50%;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: center;
            clip-path: inset(0 0 50% 0);
        }

        .score-display {
            position: absolute;
            top: 75px; /* ÙŠØªÙ…Ø±ÙƒØ² ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© */
            width: 100%;
            font-size: 3.8rem;
            font-weight: 900;
            z-index: 3;
            color: var(--text-main);
        }

        /* Ø¨Ù‚ÙŠØ© Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª (Header, Tables, Buttons) ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ */
        .watermark { position: absolute; top: 50%; left: 50%; width: 500px; height: 500px; transform: translate(-50%, -50%) rotate(-10deg); z-index: 0; pointer-events: none; opacity: 0.12; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 500'%3E%3Cdefs%3E%3Cpath id='textcircle' d='M250,400 a150,150 0 0,1 0,-300 a150,150 0 0,1 0,300 Z' transform='rotate(180,250,250)'/%3E%3C/defs%3E%3Cg style='fill:%23cba135; stroke:%23cba135;'%3E%3Ccircle cx='250' cy='250' r='240' style='fill:none; stroke-width:4; opacity: 0.7;'/%3E%3Ccircle cx='250' cy='250' r='230' style='fill:none; stroke-width:1; opacity: 0.5;'/%3E%3Ccircle cx='250' cy='250' r='180' style='fill:none; stroke-width:3; opacity: 0.7;'/%3E%3Ctext x='250' y='235' text-anchor='middle' style='font-size:85px; font-weight:900; font-family:serif; stroke:none;'%3ESMAIC%3C/text%3E%3Ctext x='250' y='285' text-anchor='middle' style='font-size:28px; font-weight:bold; letter-spacing:8px; stroke:none; opacity:0.8;'%3E2026%3C/text%3E%3Ctext dy='-20' style='stroke:none;'%3E%3CtextPath xlink:href='%23textcircle' startOffset='50%25' text-anchor='middle' style='font-size:26px; font-weight:bold; letter-spacing:2px; font-family: sans-serif;'%3E&#1580;&#1575;&#1605;&#1593;&#1577; &#1608;&#1585;&#1602;&#1604;&#1577; &#9733; PHYSICS %26 AI CLUB &#9733; &#1606;&#1575;&#1583;&#1610; &#1593;&#1604;&#1608;&#1605; &#1575;&#1604;&#1605;&#1575;&#1583;&#1577;%3C/textPath%3E%3C/text%3E%3C/g%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: center; background-size: contain; mix-blend-mode: multiply; }
        [data-theme="dark"] .watermark { filter: invert(1); opacity: 0.08; }
        header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 30px; text-align: center; position: relative; }
        .header-actions { position: absolute; top: 20px; display: flex; gap: 10px; }
        html[dir="rtl"] .header-actions { left: 20px; } html[dir="ltr"] .header-actions { right: 20px; }
        .icon-btn { background: rgba(255,255,255,0.2); border: none; width: 35px; height: 35px; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .controls { padding: 20px; display: flex; gap: 12px; flex-wrap: wrap; background: var(--mention-bg); justify-content: center; }
        button { min-width: 140px; padding: 12px 20px; border-radius: 12px; border: none; cursor: pointer; font-family: inherit; font-weight: 700; transition: 0.2s; }
        .btn-add { background: var(--primary); color: white; flex: 2; }
        .btn-exp { background: #1e293b; color: white; flex: 1; }
        .btn-pdf { background: #ef4444; color: white; flex: 1; }
        .btn-rst { background: white; color: var(--danger); border: 1px solid var(--danger); }
        .table-container { display: flex; justify-content: center; overflow-x: auto; padding: 0 15px 20px; }
        table { width: 100%; max-width: 850px; border-collapse: separate; border-spacing: 0 10px; }
        th { color: #64748b; font-size: 0.9rem; padding-bottom: 10px; }
        td { background: var(--input-bg); padding: 5px; border-radius: 10px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        input, select { width: 100%; padding: 10px; border: none; background: transparent; text-align: center; font-weight: 600; color: inherit; outline: none; }
        #motivationQuote { margin: 20px auto; padding: 20px; border-radius: 16px; background: #1e293b; color: #f1f5f9; border-right: 6px solid var(--accent); max-width: 85%; animation: slideUp 0.6s ease; display: none; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* ØªÙ†Ø³ÙŠÙ‚ ÙƒØ´Ù Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ù„Ù€ PDF Ø§Ù„Ù…Ø®ÙÙŠ */
        #transcript-template { display: none; background: white; padding: 15mm; direction: rtl; font-family: 'Amiri', serif; }
        .tr-header { text-align: center; border-bottom: 2px solid #000; margin-bottom: 10px; }
        .tr-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .tr-table th, .tr-table td { border: 1px solid #000; padding: 8px; text-align: center; }
    </style>
</head>
<body>

<audio id="sound-success" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
<audio id="sound-fail" src="https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3"></audio>

<div class="container" id="captureArea">
    <div class="watermark"></div>
    <header>
        <div class="header-actions">
            <button onclick="toggleTheme()" class="icon-btn">ğŸŒ™</button>
            <button onclick="toggleLang()" class="icon-btn">EN</button>
        </div>
        <h1 id="txt-title">Ù†Ø§Ø¯ÙŠ Ø¹Ù„ÙˆÙ… Ø§Ù„Ù…Ø§Ø¯Ø© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h1>
        <h2 id="txt-subtitle">SMAIC - Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ù„ÙƒÙŠØ© 2026</h2>
    </header>

    <div id="welcome-msg" style="text-align: center; padding: 15px; color: var(--primary); font-weight: bold;"></div>

    <div class="dashboard">
        <div class="gauge-container">
            <div class="gauge-outline"></div>
            <div class="gauge-body"></div>
            <div class="gauge-fill" id="gaugeFill"></div>
            <div class="gauge-cover"></div>
            <div class="score-display" id="finalScore">0.00</div>
        </div>
        <div id="motivationQuote"></div>
    </div>

    <div class="controls">
        <button class="btn-add" onclick="addRow()"><span id="txt-add">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</span></button>
        <button class="btn-exp" onclick="exportToImage()">ğŸ“· <span id="txt-exp">ØµÙˆØ±Ø©</span></button>
        <button class="btn-pdf" onclick="exportToPDF()">ğŸ“„ <span id="txt-pdf">ÙƒØ´Ù Ù†Ù‚Ø§Ø·</span></button>
        <button class="btn-rst" onclick="resetData()"><span id="txt-rst">ØªØµÙÙŠØ±</span></button>
    </div>

    <div class="table-container">
        <table id="gradeTable">
            <thead>
                <tr>
                    <th id="th-name">Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                    <th id="th-exam">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th>
                    <th id="th-td">TD/TP</th>
                    <th id="th-coef">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„</th>
                    <th id="th-mode">Ø§Ù„Ù†Ø¸Ø§Ù…</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<div id="transcript-template">
    <div class="tr-header">
        <h2>Ø¬Ø§Ù…Ø¹Ø© Ù‚Ø§ØµØ¯ÙŠ Ù…Ø±Ø¨Ø§Ø­ ÙˆØ±Ù‚Ù„Ø©</h2>
        <h1>ÙƒØ´Ù Ù†Ù‚Ø§Ø· Ù…Ø¤Ù‚Øª</h1>
    </div>
    <div id="tr-info" style="margin-bottom: 20px;"></div>
    <table class="tr-table">
        <thead><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„</th><th>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th><th>TD/TP</th><th>Ø§Ù„Ù…Ø¹Ø¯Ù„</th></tr></thead>
        <tbody id="tr-body"></tbody>
    </table>
    <div style="display: flex; justify-content: space-between; font-size: 20px; font-weight: bold;">
        <div id="tr-decision">Ø§Ù„Ù‚Ø±Ø§Ø±: --</div>
        <div id="tr-gpa">Ø§Ù„Ù…Ø¹Ø¯Ù„: 0.00</div>
    </div>
</div>

<script>
    // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    const langData = {
        ar: { title: "Ù†Ø§Ø¯ÙŠ Ø¹Ù„ÙˆÙ… Ø§Ù„Ù…Ø§Ø¯Ø© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", subtitle: "SMAIC - Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù…Ù„ÙƒÙŠØ© 2026", welcome: "Ø¨ÙˆØ§Ø¨Ø© SMAIC Ø§Ù„Ø±Ù‚Ù…ÙŠØ©: Ø­ÙŠØ« Ù„Ø§ ØªÙÙ‚Ø§Ø³ Ù‚ÙŠÙ…ØªÙƒ Ø¨Ù…Ø§ ØªØ­Ù…Ù„Ù‡ Ø§Ù„ÙˆØ±Ù‚Ø©ØŒ Ø¨Ù„ Ø¨Ù…Ø§ ÙŠØ³ØªØ·ÙŠØ¹Ù‡ Ø¹Ù‚Ù„Ùƒ..", add: "+ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©", exp: "ØµÙˆØ±Ø©", pdf: "ÙƒØ´Ù Ù†Ù‚Ø§Ø·", rst: "ØªØµÙÙŠØ±", th_name: "Ø§Ù„Ù…Ø§Ø¯Ø©", th_exam: "Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†", th_td: "TD/TP", th_coef: "Ø§Ù„Ù…Ø¹Ø§Ù…Ù„", th_mode: "Ø§Ù„Ù†Ø¸Ø§Ù…", ph_name: "Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©...", mode_mixed: "67% Ø¥Ù…ØªØ­Ø§Ù† + 33% TD", sig: "Ø§Ù„Ø¯Ø±Ø¬Ø§ØªÙ Ø£Ø±Ù‚Ø§Ù…ÙŒ Ø¹Ø§Ø¨Ø±Ø©ØŒ Ùˆ SMAIC ÙˆØ·Ù†Ù Ø§Ù„Ø®Ø§Ù„Ø¯ÙŠÙ†.." },
        en: { title: "Material Sciences & AI Club", subtitle: "SMAIC - ROYAL GPA CALCULATOR 2026", welcome: "SMAIC Digital Portal: Your value isn't measured by paper, but by what your mind can achieve.", add: "+ Add Subject", exp: "Image", pdf: "Transcript", rst: "Reset", th_name: "Subject", th_exam: "Exam", th_td: "TD/TP", th_coef: "Coef", th_mode: "Mode", ph_name: "Subject Name...", mode_mixed: "67% Exam + 33% TD", sig: "Grades are fleeting numbers, SMAIC is where legends are made." }
    };

    const quotesDB = {
        ar: { diamond: "Ø£Ù†Øª Ù„Ø³Øª Ù…Ø¬Ø±Ø¯ Ø±Ù‚Ù…ØŒ Ø£Ù†Øª Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ØªÙŠ Ø¨Ù„ØºØª Ø§Ù„ÙƒÙ…Ø§Ù„.", gold: "Ø¨Ø°ÙƒØ§Ø¡Ù Ø³ÙŠØ§Ø¯ÙŠÙ‘ ÙØ±Ø¶ØªÙ Ù…Ù†Ø·Ù‚ÙƒØ› Ø£Ù†Øª Ø£Ø­Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØªÙŠ Ù†Ø±Ø§Ù‡Ù† Ø¹Ù„ÙŠÙ‡Ø§.", silver: "Ø£ØªÙ‚Ù†Øª ÙÙ† Ø§Ù„ØªÙˆØ§Ø²Ù†Ø› Ù†Ø±Ù‰ ÙÙŠÙƒ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø®Ø§Ù… Ù„Ù„Ù‚ÙŠØ§Ø¯Ø©.", resilience: "Ø¹Ø¨Ø±ØªÙ Ø¨Ø³Ù„Ø§Ù…ØŒ ÙØ§Ù„Ø¹Ø¨Ø±Ø© Ø¨Ù…Ù† ÙŠÙ…ØªÙ„Ùƒ Ø§Ù„Ù†ÙØ³ Ø§Ù„Ø·ÙˆÙŠÙ„.", challenge: "Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø¹Ø§Ù„ÙŠ Ù‡Ùˆ Ù…Ø§ ÙŠØµÙ†Ø¹ Ø§Ù„Ø£Ù„Ù…Ø§Ø³Ø› Ø³Ù‚ÙˆØ·Ùƒ Ø§Ù„ÙŠÙˆÙ… Ù‡Ùˆ Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ù„Ù†Ø¸Ø§Ù…Ùƒ." }
    };

    let curLang = 'ar';
    let subjects = [{name: "", exam: null, td: null, coef: 1, mode: "mixed"}];
    let lastState = null;

    window.onload = () => { renderTable(); typeWriter(); };

    function addRow() { subjects.push({name: "", exam: null, td: null, coef: 1, mode: "mixed"}); renderTable(); }

    function renderTable() {
        const t = langData[curLang];
        document.getElementById('tableBody').innerHTML = subjects.map((s, i) => `
            <tr>
                <td><input type="text" placeholder="${t.ph_name}" value="${s.name}" oninput="updateData(${i}, 'name', this.value)"></td>
                <td><input type="number" step="0.01" value="${s.exam || ''}" oninput="updateData(${i}, 'exam', this.value)"></td>
                <td><input type="number" step="0.01" value="${s.td || ''}" oninput="updateData(${i}, 'td', this.value)"></td>
                <td><input type="number" value="${s.coef}" oninput="updateData(${i}, 'coef', this.value)"></td>
                <td><select onchange="updateData(${i}, 'mode', this.value)">
                    <option value="mixed">${t.mode_mixed}</option>
                    <option value="100exam">100% Ø¥Ù…ØªØ­Ø§Ù†</option>
                    <option value="100td">100% TD/TP</option>
                </select></td>
                <td><button onclick="removeRow(${i})" style="color:red; background:none; min-width:auto">âœ•</button></td>
            </tr>`).join('');
        calculate();
    }

    function updateData(i, f, v) { 
        subjects[i][f] = (f==='name'||f==='mode') ? v : (v===""?null:parseFloat(v)); 
        calculate(); 
    }

    function removeRow(i) { subjects.splice(i, 1); renderTable(); }

    function calculate() {
        let totalWeighted = 0, totalCoef = 0, hasData = false;
        subjects.forEach(s => {
            let m = 0; const ex = s.exam || 0; const td = s.td || 0;
            if(s.exam !== null || s.td !== null) hasData = true;
            if (s.mode === 'mixed') m = ex * 0.67 + td * 0.33;
            else if (s.mode === '100td') m = td;
            else m = ex;
            totalWeighted += m * (s.coef||1); totalCoef += (s.coef||1);
        });

        const gpa = totalCoef > 0 ? totalWeighted / totalCoef : 0;
        document.getElementById('finalScore').innerText = gpa.toFixed(2);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚ÙŠØ§Ø³ (Gauge)
        const gaugeFill = document.getElementById('gaugeFill');
        // Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ù…Ù† -180 (ØµÙØ±) Ø¥Ù„Ù‰ 0 (20/20)
        const angle = -180 + ((gpa / 20) * 180);
        gaugeFill.style.transform = `rotate(${angle}deg)`;

        // ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©
        let color = "#ef4444";
        if(gpa >= 16) color = "#8b5cf6"; // Ù…Ù…ØªØ§Ø² (Ø¨Ù†ÙØ³Ø¬ÙŠ)
        else if(gpa >= 13) color = "#10b981"; // Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ (Ø£Ø®Ø¶Ø±)
        else if(gpa >= 10) color = "#f59e0b"; // Ù…Ù‚Ø¨ÙˆÙ„ (Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ)
        
        gaugeFill.style.background = color;

        // ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¬Ø§Ø­
        if (hasData && gpa >= 10 && lastState !== 'pass') {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            lastState = 'pass';
        } else if (gpa < 10) lastState = 'fail';

        updateMotivation(gpa, hasData);
    }

    function updateMotivation(gpa, hasData) {
        const box = document.getElementById('motivationQuote');
        if(!hasData || gpa === 0) { box.style.display='none'; return; }
        let text = "";
        if(gpa >= 17) text = quotesDB.ar.diamond;
        else if(gpa >= 14) text = quotesDB.ar.gold;
        else if(gpa >= 10) text = quotesDB.ar.silver;
        else text = quotesDB.ar.challenge;
        box.innerHTML = `"${text}" <br><small>${langData[curLang].sig}</small>`;
        box.style.display = 'block';
    }

    function typeWriter() {
        const msg = langData[curLang].welcome;
        let i = 0;
        const el = document.getElementById("welcome-msg");
        el.innerHTML = "";
        function type() { if(i < msg.length) { el.innerHTML += msg.charAt(i); i++; setTimeout(type, 40); } }
        type();
    }

    function toggleTheme() {
        const html = document.documentElement;
        html.setAttribute('data-theme', html.getAttribute('data-theme') === 'light' ? 'dark' : 'light');
    }

    function exportToImage() {
        htmlToImage.toPng(document.getElementById('captureArea')).then(dataUrl => {
            const link = document.createElement('a');
            link.download = 'SMAIC-Result.png';
            link.href = dataUrl;
            link.click();
        });
    }

    async function exportToPDF() {
        const name = prompt("Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:");
        document.getElementById('tr-info').innerText = `Ø§Ù„Ø·Ø§Ù„Ø¨: ${name} | Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString()}`;
        const tbody = document.getElementById('tr-body');
        tbody.innerHTML = subjects.map(s => `<tr><td>${s.name}</td><td>${s.coef}</td><td>${s.exam}</td><td>${s.td}</td><td>-</td></tr>`).join('');
        document.getElementById('tr-gpa').innerText = `Ø§Ù„Ù…Ø¹Ø¯Ù„: ${document.getElementById('finalScore').innerText}`;
        
        const element = document.getElementById('transcript-template');
        element.style.display = 'block';
        await html2pdf().from(element).save();
        element.style.display = 'none';
    }

    function resetData() { subjects = [{name: "", exam: null, td: null, coef: 1, mode: "mixed"}]; renderTable(); }
</script>
</body>
</html>
