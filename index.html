<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMAIC - GPA Calculator</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Poppins:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary: #4f46e5; --primary-dark: #4338ca; --accent: #fbbf24;
            --bg-body: #f0f4ff; --bg-gradient: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            --card-bg: rgba(255, 255, 255, 0.98); --text-main: #1e293b;
            --input-bg: #f8fafc; --mention-bg: #f1f5f9;
            --danger: #ef4444; --success: #10b981;
            --font-ar: 'Cairo', sans-serif; --font-en: 'Poppins', sans-serif;
        }

        [data-theme="dark"] {
            --primary: #6366f1; --bg-body: #0f172a;
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --card-bg: rgba(30, 41, 59, 0.98); --text-main: #f1f5f9;
            --input-bg: #334155; --mention-bg: #1e293b;
        }

        body { font-family: var(--font-ar); background: var(--bg-gradient); margin: 0; padding: 20px; color: var(--text-main); min-height: 100vh; transition: 0.3s; }
        
        .container {
            width: 100%; max-width: 900px; background: var(--card-bg);
            border-radius: 24px; margin: 0 auto; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            overflow: hidden; position: relative; border: 1px solid rgba(255,255,255,0.1);
        }

        header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 30px; text-align: center; position: relative; }
        .header-actions { position: absolute; top: 20px; display: flex; gap: 10px; }
        html[dir="rtl"] .header-actions { left: 20px; } html[dir="ltr"] .header-actions { right: 20px; }
        
        .icon-btn { background: rgba(255,255,255,0.2); border: none; width: 35px; height: 35px; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        
        .dashboard { padding: 30px 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .score-display { font-size: 3.5rem; font-weight: 900; margin-top: -30px; position: relative; z-index: 2; }
        .gauge-wrapper { position: relative; width: 220px; height: 110px; margin: 0 auto; overflow: hidden; }
        .gauge-bg { width: 220px; height: 110px; background: rgba(0,0,0,0.1); border-radius: 110px 110px 0 0; }
        .gauge-fill { width: 220px; height: 110px; background: var(--success); border-radius: 110px 110px 0 0; position: absolute; top: 0; left: 0; transform-origin: center bottom; transform: rotate(-180deg); transition: 1s cubic-bezier(0.34, 1.56, 0.64, 1); }
        
        .controls { padding: 15px; display: flex; gap: 10px; flex-wrap: wrap; background: var(--mention-bg); justify-content: center; }
        button { padding: 12px 20px; border-radius: 12px; border: none; cursor: pointer; font-family: inherit; font-weight: 700; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        
        .btn-add { background: var(--primary); color: white; flex: 2; min-width: 200px; }
        .btn-exp { background: #1e293b; color: white; flex: 1; }
        .btn-rst { background: white; color: var(--danger); border: 1px solid var(--danger); flex: 1; }

        .table-container { overflow-x: auto; padding: 20px; }
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        th { color: #64748b; font-size: 0.85rem; padding-bottom: 10px; }
        td { background: var(--input-bg); padding: 5px; border-radius: 8px; }
        
        input, select { width: 100%; padding: 10px; border: none; background: transparent; text-align: center; font-weight: 600; color: inherit; outline: none; }
        
        #motivationQuote { margin: 20px auto; padding: 20px; border-radius: 15px; background: #1e293b; color: #fff; border-right: 5px solid var(--accent); display: none; max-width: 80%; }
    </style>
</head>
<body>

<audio id="sound-success" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3" preload="auto"></audio>
<audio id="sound-fail" src="https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3" preload="auto"></audio>

<div class="container" id="captureArea">
    <header>
        <div class="header-actions">
            <button onclick="toggleTheme()" class="icon-btn">ğŸŒ™</button>
            <button onclick="toggleLang()" class="icon-btn">EN</button>
        </div>
        <h1 id="txt-title">Ù†Ø§Ø¯ÙŠ Ø¹Ù„ÙˆÙ… Ø§Ù„Ù…Ø§Ø¯Ø© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h1>
        <h2 id="txt-subtitle" style="font-weight:400; opacity:0.9; font-size:1rem;">SMAIC - GPA CALCULATOR 2026</h2>
    </header>

    <div class="dashboard">
        <div class="gauge-wrapper">
            <div class="gauge-bg"></div>
            <div class="gauge-fill" id="gaugeFill"></div>
        </div>
        <div class="score-display" id="finalScore">0.00</div>
        <div id="motivationQuote"></div>
    </div>

    <div class="controls" data-html2canvas-ignore="true">
        <button class="btn-add" onclick="addRow()"><span id="txt-add">+ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</span></button>
        <button class="btn-exp" onclick="exportToImage()">ğŸ“· <span id="txt-exp">Ø­ÙØ¸ ØµÙˆØ±Ø©</span></button>
        <button class="btn-rst" onclick="resetData()"><span id="txt-rst">ØªØµÙÙŠØ±</span></button>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th id="th-name">Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                    <th id="th-exam">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th>
                    <th id="th-td">TD/TP</th>
                    <th id="th-coef">Ø§Ù„Ù…Ø¹Ø§Ù…Ù„</th>
                    <th id="th-mode">Ø§Ù„Ù†Ø¸Ø§Ù…</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <div style="text-align: center; padding: 20px; font-size: 0.8rem; opacity: 0.6;">
        Developed by: Kourde Boudjamaa | SMAIC President
    </div>
</div>

<script>
    let curLang = 'ar';
    let subjects = [{name: "", exam: null, td: null, coef: 1, mode: "mixed"}];
    let lastStatus = null;

    const langData = {
        ar: { title: "Ù†Ø§Ø¯ÙŠ Ø¹Ù„ÙˆÙ… Ø§Ù„Ù…Ø§Ø¯Ø© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", add: "+ Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©", exp: "ØµÙˆØ±Ø©", rst: "ØªØµÙÙŠØ±", ph_name: "Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©..." },
        en: { title: "Material Sciences & AI Club", add: "+ Add Subject", exp: "Image", rst: "Reset", ph_name: "Subject Name..." }
    };

    function renderTable() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = subjects.map((s, i) => `
            <tr>
                <td><input type="text" placeholder="${langData[curLang].ph_name}" value="${s.name}" oninput="updateData(${i}, 'name', this.value)"></td>
                <td><input type="number" step="0.01" value="${s.exam || ''}" oninput="updateData(${i}, 'exam', this.value)" ${s.mode==='100td'?'disabled':''}></td>
                <td><input type="number" step="0.01" value="${s.td || ''}" oninput="updateData(${i}, 'td', this.value)" ${s.mode==='100exam'?'disabled':''}></td>
                <td><input type="number" value="${s.coef}" oninput="updateData(${i}, 'coef', this.value)"></td>
                <td><select onchange="updateData(${i}, 'mode', this.value)">
                    <option value="mixed" ${s.mode==='mixed'?'selected':''}>Ø£Ø³Ø§Ø³ÙŠ</option>
                    <option value="100exam" ${s.mode==='100exam'?'selected':''}>Ø¥Ù…ØªØ­Ø§Ù† ÙÙ‚Ø·</option>
                    <option value="100td" ${s.mode==='100td'?'selected':''}>ØªØ·Ø¨ÙŠÙ‚ÙŠ ÙÙ‚Ø·</option>
                </select></td>
                <td><button onclick="removeRow(${i})" style="color:red; background:none;">âœ•</button></td>
            </tr>
        `).join('');
        calculate();
    }

    function calculate() {
        let totalWeighted = 0, totalCoef = 0, hasData = false;
        subjects.forEach(s => {
            if(s.exam !== null || s.td !== null) hasData = true;
            let m = 0;
            if (s.mode === 'mixed') m = (s.exam||0)*0.67 + (s.td||0)*0.33;
            else if (s.mode === '100td') m = (s.td||0);
            else m = (s.exam||0);
            totalWeighted += m * (s.coef||1);
            totalCoef += (s.coef||1);
        });

        const gpa = totalCoef > 0 ? totalWeighted / totalCoef : 0;
        document.getElementById('finalScore').innerText = gpa.toFixed(2);
        document.getElementById('gaugeFill').style.transform = `rotate(${-180 + (gpa/20)*180}deg)`;

        if (hasData && gpa > 0) {
            let status = gpa >= 10 ? 'pass' : 'fail';
            if (status !== lastStatus) {
                document.getElementById(status === 'pass' ? 'sound-success' : 'sound-fail').play().catch(()=>{});
                if(status === 'pass') confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                lastStatus = status;
            }
        }
        
        const q = document.getElementById('motivationQuote');
        if(hasData && gpa > 0) {
            q.style.display = 'block';
            q.innerText = gpa >= 10 ? "Ø£Ø­Ø³Ù†Øª! Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªÙ…ÙŠØ² Ù…Ø¹ SMAIC" : "ÙØ±ØµØ© Ø£Ø®Ø±Ù‰ Ù‚Ø§Ø¯Ù…Ø©ØŒ Ù„Ø§ ØªØªÙˆÙ‚Ù Ù‡Ù†Ø§!";
        } else { q.style.display = 'none'; }
    }

    function updateData(i, f, v) { subjects[i][f] = (f==='name'||f==='mode')? v : (v===""?null:parseFloat(v)); if(f==='mode') renderTable(); else calculate(); }
    function addRow() { subjects.push({name: "", exam: null, td: null, coef: 1, mode: "mixed"}); renderTable(); }
    function removeRow(i) { subjects.splice(i, 1); renderTable(); }
    function toggleTheme() { document.documentElement.setAttribute('data-theme', document.documentElement.getAttribute('data-theme')==='light'?'dark':'light'); }
    function toggleLang() { curLang = curLang==='ar'?'en':'ar'; renderTable(); }
    function resetData() { subjects = [{name: "", exam: null, td: null, coef: 1, mode: "mixed"}]; lastStatus = null; renderTable(); }

    function exportToImage() {
        const node = document.getElementById('captureArea');
        htmlToImage.toPng(node).then(dataUrl => {
            const link = document.createElement('a');
            link.download = `SMAIC-Result-${new Date().getTime()}.png`;
            link.href = dataUrl;
            link.click();
        });
    }

    window.onload = renderTable;
</script>
</body>
</html>
